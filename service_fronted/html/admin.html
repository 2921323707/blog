<!DOCTYPE html>
<html lang="zh-CN" data-page="admin">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>åšå®¢æ–‡ç« ç¼–è¾‘å™¨</title>
    <link rel="stylesheet" href="/static/css/admin.css">
    <script src="https://cdn.jsdelivr.net/npm/marked@11.1.1/marked.min.js"></script>
    <script>
        // åœ¨é¡µé¢åŠ è½½å‰é˜»æ­¢ä¸»é¢˜è„šæœ¬å¹¶è®¾ç½®é”™è¯¯å¤„ç†
        window.GLOBAL_CONFIG = window.GLOBAL_CONFIG || {};
        window.GLOBAL_CONFIG_SITE = window.GLOBAL_CONFIG_SITE || {};
        window.GLOBAL_CONFIG_SITE.pageType = 'admin';

        // æå‰è®¾ç½®å…¨å±€é”™è¯¯å¤„ç†ï¼Œæ•è·ä¸»é¢˜è„šæœ¬é”™è¯¯
        window.addEventListener('error', function (e) {
            // å¦‚æœæ˜¯ page-events.js æˆ–å…¶ä»–ä¸»é¢˜è„šæœ¬çš„é”™è¯¯ï¼Œå¿½ç•¥å®ƒ
            if (e.filename && (e.filename.includes('page-events') ||
                e.filename.includes('main.js') ||
                e.filename.includes('utils.js') ||
                e.filename.includes('butterfly'))) {
                e.preventDefault();
                e.stopPropagation();
                e.stopImmediatePropagation();
                return true;
            }
            // å¦‚æœé”™è¯¯ä¿¡æ¯åŒ…å« length ç›¸å…³çš„ä¸»é¢˜è„šæœ¬é”™è¯¯ï¼Œä¹Ÿå¿½ç•¥
            if (e.message && (
                e.message.includes('Cannot read properties of undefined') ||
                (e.message.includes('length') && e.filename && e.filename.includes('.js'))
            )) {
                e.preventDefault();
                e.stopPropagation();
                e.stopImmediatePropagation();
                return true;
            }
        }, true);

        // æ•è·æœªå¤„ç†çš„ Promise é”™è¯¯
        window.addEventListener('unhandledrejection', function (e) {
            const reason = e.reason ? e.reason.toString() : '';
            if (reason.includes('page-events') ||
                reason.includes('Cannot read properties') ||
                (reason.includes('length') && reason.includes('undefined'))) {
                e.preventDefault();
            }
        });
    </script>
</head>

<body>
    <div class="container">
        <h1>åšå®¢æ–‡ç« ç¼–è¾‘å™¨</h1>

        <form id="postForm">
            <div class="form-group">
                <label for="title">æ–‡ç« æ ‡é¢˜ *</label>
                <input type="text" id="title" name="title" required placeholder="è¯·è¾“å…¥æ–‡ç« æ ‡é¢˜">
            </div>

            <div class="form-group">
                <label for="date">å‘å¸ƒæ—¥æœŸ</label>
                <input type="date" id="date" name="date">
                <div class="help-text">ç•™ç©ºåˆ™ä½¿ç”¨å½“å‰æ—¥æœŸ</div>
            </div>

            <div class="form-group">
                <label>æ ‡ç­¾</label>
                <div class="tags-input">
                    <input type="text" class="tag-input" id="tagInput" placeholder="è¾“å…¥æ ‡ç­¾åæŒ‰å›è½¦æ·»åŠ ">
                </div>
                <div id="tagsContainer" class="tags-input"></div>
            </div>

            <div class="form-group">
                <label>åˆ†ç±»</label>
                <div class="categories-input">
                    <input type="text" class="category-input" id="categoryInput" placeholder="è¾“å…¥åˆ†ç±»åæŒ‰å›è½¦æ·»åŠ ">
                </div>
                <div id="categoriesContainer" class="tags-input"></div>
            </div>

            <div class="form-group">
                <label>å›¾ç‰‡ä¸Šä¼ </label>
                <div class="upload-area" id="uploadArea">
                    <p>ğŸ“· ç‚¹å‡»æˆ–æ‹–æ‹½å›¾ç‰‡åˆ°è¿™é‡Œä¸Šä¼ </p>
                    <input type="file" id="fileInput" multiple accept="image/*" style="display: none;">
                </div>
                <div class="image-preview" id="imagePreview"></div>
                <div class="help-text">ä¸Šä¼ çš„å›¾ç‰‡ä¼šè‡ªåŠ¨æ’å…¥åˆ°æ–‡ç« æœ«å°¾ï¼Œæ‚¨å¯ä»¥åœ¨ç¼–è¾‘å™¨ä¸­ç§»åŠ¨ä½ç½®</div>
            </div>

            <div class="form-group">
                <label for="content">æ–‡ç« å†…å®¹ (Markdown) *</label>
                <textarea id="content" name="content" required placeholder="ä½¿ç”¨ Markdown æ ¼å¼ç¼–å†™æ–‡ç« å†…å®¹..."></textarea>
                <div class="help-text">
                    æ”¯æŒ Markdown è¯­æ³•ã€‚å›¾ç‰‡å¼•ç”¨æ ¼å¼: ![æè¿°](/img/å›¾ç‰‡å.jpg)<br>
                    å¤–éƒ¨é“¾æ¥æ ¼å¼: [é“¾æ¥æ–‡æœ¬](https://example.com) - ç‚¹å‡»é¢„è§ˆæŒ‰é’®å¯æŸ¥çœ‹æ¸²æŸ“æ•ˆæœ
                </div>
            </div>

            <div class="actions">
                <button type="submit" class="btn" id="submitBtn">æäº¤æ–‡ç« </button>
                <button type="button" class="btn btn-secondary" id="previewBtn">é¢„è§ˆ</button>
            </div>

            <div class="status" id="status"></div>
        </form>
    </div>

    <!-- é¢„è§ˆæ¨¡æ€æ¡† -->
    <div id="previewModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>æ–‡ç« é¢„è§ˆ</h2>
                <span class="modal-close" id="closePreview">&times;</span>
            </div>
            <div class="modal-body">
                <div id="previewContent" class="markdown-preview"></div>
            </div>
        </div>
    </div>

    <script src="/static/js/admin.js"></script>
</body>

</html>